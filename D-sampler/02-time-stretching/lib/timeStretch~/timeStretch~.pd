#N canvas 661 62 716 380 10;
#X declare -path ./lib;
#N canvas 647 119 793 726 FFT-reblocking 0;
#X obj 80 639 *~;
#X obj 217 317 rfft~;
#X obj 114 152 rfft~;
#X obj 81 515 rifft~;
#X obj 80 668 outlet~;
#X obj 445 498 block~;
#X obj 80 565 *~;
#X obj 78 118 /~;
#X obj 45 118 /~;
#X obj 46 354 /~;
#X obj 147 343 /~;
#X obj 122 590 t b f;
#X msg 122 613 2;
#X obj 122 636 /;
#X obj 168 618 * 3;
#N canvas 697 91 270 255 get-mag 0;
#X obj 69 22 inlet~;
#X obj 162 107 *~;
#X obj 69 107 *~;
#X obj 69 133 +~;
#X obj 69 157 sqrt~;
#X obj 162 22 inlet~;
#X obj 69 203 outlet~;
#X connect 0 0 2 0;
#X connect 0 0 2 1;
#X connect 1 0 3 1;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 1 0;
#X connect 5 0 1 1;
#X restore 62 303 pd get-mag;
#N canvas 697 91 270 255 get-mag 0;
#X obj 69 22 inlet~;
#X obj 142 67 *~;
#X obj 69 67 *~;
#X obj 69 93 +~;
#X obj 69 117 sqrt~;
#X obj 142 22 inlet~;
#X obj 69 140 +~ 1e-20;
#X obj 69 163 outlet~;
#X connect 0 0 2 0;
#X connect 0 0 2 1;
#X connect 1 0 3 1;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 1 0;
#X connect 5 0 1 1;
#X connect 6 0 7 0;
#X restore 87 75 pd get-mag;
#X text 145 512 <-- inverse FFT;
#X obj 46 258 +~ 1e-15;
#X obj 385 97 cnv 15 250 100 empty empty empty 20 12 0 14 -4034 -66577
0;
#N canvas 2085 107 561 795 comments 0;
#X text 43 33 Whatever the previous frame's analysis values were \,
normalize them by dividing by the magnitude. This gives all of the
complex numbers a magnitude of 1 \, but preserves their angles (phases).
;
#X text 43 593 OR \, rearranging things:;
#X text 43 113 The "read-windows" subpatch outputs windows of audio
from the sample \, with one lagging 1/4 window behind the other. The
start points of these windows are controlled by the manual "location"
control \, or if you're using the "speed" control \, the location moves
forward automatically at whatever speed.;
#X text 43 223 The rear window of audio coming out of read-windows
is transformed into the frequency domain via rfft~. We want to look
at the phases of its components and artificially alter them. When two
complex numbers are multiplied together \, their arguments/angles/phases
ADD. So \, by multiplying the unit magnitude analysis results of the
previous frame against the CONJUGATES of the rear window's components
\, we're actually SUBTRACTING their angles from the previous analysis
values. At that stage \, we've altered the complex numbers to have
the magnitudes of the rear window \, and phases: PreviousPhase MINUS
RearWindowPhase.;
#X text 43 663 In other words \, we measured the difference in phase
between the forward and rear windows (which are window-size/4 samples
apart in time) \, and then added that difference to whatever the phase
was in the last frame. We're just artificially moving the phase forward
by however much it would have gone naturally over that time period.
;
#X text 43 423 Next \, we normalize that as well \, so we have unit
magnitude again. Then we do one more complex multiply \, this time
against the front window. Again: multiplying complex numbers results
in ADDITION of their arguments/angles/phases. Last time we multiplied
against the conjugates \, so we had subtraction \, but this time we
use the original complex numbers and therefore add. So we've done something
like this with the phases:;
#X text 43 563 PreviousPhases - RearWindowPhases + ForwardWindowPhases
;
#X text 43 623 PreviousPhases + (ForwardWindowPhases - RearWindowPhases)
;
#X restore 466 140 pd comments;
#X obj 146 177 *~ -1;
#N canvas 296 55 815 371 complex-mult 0;
#X obj 420 184 *~;
#X obj 384 184 *~;
#X obj 331 184 *~;
#X obj 300 184 *~;
#X obj 300 220 -~;
#X obj 384 217 +~;
#X obj 300 258 outlet~;
#X obj 384 258 outlet~;
#X obj 300 68 inlet~;
#X obj 384 68 inlet~;
#X obj 470 68 inlet~;
#X obj 554 68 inlet~;
#X text 211 293 Real result;
#X text 444 293 Imaginary result;
#X text 20 198 (Real1 * Real2) - (Imag1 * Imag2);
#X text 50 230 MINUS \, because i*i = -1;
#X text 470 198 (Imag1 * Real2) + (Real1 * Imag2);
#X text 488 34 Second multiplicand: real/imaginary;
#X text 170 34 First multiplicand: real/imaginary;
#X connect 0 0 5 1;
#X connect 1 0 5 0;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 7 0;
#X connect 8 0 3 0;
#X connect 8 0 0 0;
#X connect 9 0 2 0;
#X connect 9 0 1 0;
#X connect 10 0 3 1;
#X connect 10 0 1 1;
#X connect 11 0 2 1;
#X connect 11 0 0 1;
#X restore 46 233 pd complex-mult;
#N canvas 296 54 793 368 complex-mult 0;
#X obj 415 169 *~;
#X obj 379 169 *~;
#X obj 326 169 *~;
#X obj 295 169 *~;
#X obj 295 205 -~;
#X obj 379 202 +~;
#X obj 295 243 outlet~;
#X obj 379 243 outlet~;
#X obj 295 53 inlet~;
#X obj 379 53 inlet~;
#X obj 465 53 inlet~;
#X obj 549 53 inlet~;
#X text 206 278 Real result;
#X text 439 278 Imaginary result;
#X text 15 183 (Real1 * Real2) - (Imag1 * Imag2);
#X text 45 215 MINUS \, because i*i = -1;
#X text 465 183 (Imag1 * Real2) + (Real1 * Imag2);
#X text 483 19 Second multiplicand: real/imaginary;
#X text 165 19 First multiplicand: real/imaginary;
#X connect 0 0 5 1;
#X connect 1 0 5 0;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 6 0;
#X connect 5 0 7 0;
#X connect 8 0 3 0;
#X connect 8 0 0 0;
#X connect 9 0 2 0;
#X connect 9 0 1 0;
#X connect 10 0 3 1;
#X connect 10 0 1 1;
#X connect 11 0 2 1;
#X connect 11 0 0 1;
#X restore 46 416 pd complex-mult;
#X text 180 226 <-- complex multiplication: normalized previous times
the conjugate of the back window.;
#X text 200 177 <-- flip the sign of the imaginary component to get
the conjugate;
#N canvas 542 225 566 495 hann-window 0;
#X obj 41 81 until;
#X obj 41 132 f;
#X obj 81 132 + 1;
#X obj 82 222 f 6.2832;
#X obj 82 297 cos;
#X obj 82 270 *;
#X obj 41 367 * 0.5;
#X obj 41 163 t b b f f;
#X msg 62 106 0;
#X obj 41 343 -;
#X msg 41 270 1;
#X obj 41 51 t f b b f;
#X obj 174 147 pack f f;
#X obj 159 123 f \$0;
#X obj 41 21 r \$0-timestretch-window-size;
#X msg 178 172 \; \$1-timestretch-hann resize \$2 \;;
#X obj 168 222 /;
#X obj 311 329 table \$0-timestretch-hann;
#X obj 41 388 tabwrite \$0-timestretch-hann;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 0 7 0;
#X connect 2 0 1 1;
#X connect 3 0 5 0;
#X connect 4 0 9 1;
#X connect 5 0 4 0;
#X connect 6 0 18 0;
#X connect 7 0 10 0;
#X connect 7 1 3 0;
#X connect 7 2 16 0;
#X connect 7 3 18 1;
#X connect 8 0 1 1;
#X connect 9 0 6 0;
#X connect 10 0 9 0;
#X connect 11 0 0 0;
#X connect 11 1 8 0;
#X connect 11 2 13 0;
#X connect 11 3 12 1;
#X connect 11 3 16 1;
#X connect 12 0 15 0;
#X connect 13 0 12 0;
#X connect 14 0 11 0;
#X connect 16 0 5 1;
#X restore 469 48 pd hann-window;
#N canvas 717 76 723 500 read-windows 0;
#X obj 132 390 outlet~;
#X obj 407 391 outlet~;
#X obj 71 86 timestretch-reader-abs \$0 0;
#X obj 71 106 timestretch-reader-abs \$0 1;
#X obj 351 126 timestretch-reader-abs \$0 10;
#X obj 71 146 timestretch-reader-abs \$0 3;
#X obj 71 126 timestretch-reader-abs \$0 2;
#X obj 71 166 timestretch-reader-abs \$0 4;
#X obj 71 186 timestretch-reader-abs \$0 5;
#X obj 71 206 timestretch-reader-abs \$0 6;
#X obj 71 226 timestretch-reader-abs \$0 7;
#X obj 351 86 timestretch-reader-abs \$0 8;
#X obj 351 106 timestretch-reader-abs \$0 9;
#X obj 351 146 timestretch-reader-abs \$0 11;
#X obj 351 166 timestretch-reader-abs \$0 12;
#X obj 351 186 timestretch-reader-abs \$0 13;
#X obj 351 206 timestretch-reader-abs \$0 14;
#X obj 351 226 timestretch-reader-abs \$0 15;
#X connect 2 0 0 0;
#X connect 2 1 1 0;
#X connect 3 0 0 0;
#X connect 3 1 1 0;
#X connect 4 0 0 0;
#X connect 4 1 1 0;
#X connect 5 0 0 0;
#X connect 5 1 1 0;
#X connect 6 0 0 0;
#X connect 6 1 1 0;
#X connect 7 0 0 0;
#X connect 7 1 1 0;
#X connect 8 0 0 0;
#X connect 8 1 1 0;
#X connect 9 0 0 0;
#X connect 9 1 1 0;
#X connect 10 0 0 0;
#X connect 10 1 1 0;
#X connect 11 0 0 0;
#X connect 11 1 1 0;
#X connect 12 0 0 0;
#X connect 12 1 1 0;
#X connect 13 0 0 0;
#X connect 13 1 1 0;
#X connect 14 0 0 0;
#X connect 14 1 1 0;
#X connect 15 0 0 0;
#X connect 15 1 1 0;
#X connect 16 0 0 0;
#X connect 16 1 1 0;
#X connect 17 0 0 0;
#X connect 17 1 1 0;
#X restore 114 118 pd read-windows;
#X text 429 107 Detailed comments inside!;
#X msg 445 474 set \$1 4;
#X obj 445 398 r \$0-timestretch-window-size;
#X obj 98 540 tabreceive~ \$0-timestretch-hann;
#X obj 122 567 r \$0-timestretch-window-size;
#X obj 47 478 tabsend~ \$0-timestretch-prev-real;
#X obj 148 446 tabsend~ \$0-timestretch-prev-imag;
#X obj 45 9 tabreceive~ \$0-timestretch-prev-real;
#X obj 79 40 tabreceive~ \$0-timestretch-prev-imag;
#X obj 412 7 table \$0-timestretch-prev-real;
#X obj 412 27 table \$0-timestretch-prev-imag;
#X obj 530 439 pack f \$0;
#X msg 530 459 \; \$2-timestretch-prev-real resize \$1 \; \$2-timestretch-prev-imag
resize \$1 \;;
#X connect 0 0 4 0;
#X connect 1 0 23 2;
#X connect 1 1 23 3;
#X connect 2 0 22 2;
#X connect 2 1 21 0;
#X connect 3 0 6 0;
#X connect 6 0 0 0;
#X connect 7 0 22 1;
#X connect 8 0 22 0;
#X connect 9 0 23 0;
#X connect 10 0 23 1;
#X connect 11 0 12 0;
#X connect 11 1 14 0;
#X connect 12 0 13 0;
#X connect 13 0 0 1;
#X connect 14 0 13 1;
#X connect 15 0 9 1;
#X connect 15 0 10 1;
#X connect 16 0 7 1;
#X connect 16 0 8 1;
#X connect 18 0 15 0;
#X connect 18 0 9 0;
#X connect 21 0 22 3;
#X connect 22 0 18 0;
#X connect 22 1 15 1;
#X connect 22 1 10 0;
#X connect 23 0 3 0;
#X connect 23 0 33 0;
#X connect 23 1 3 1;
#X connect 23 1 34 0;
#X connect 27 0 2 0;
#X connect 27 1 1 0;
#X connect 29 0 5 0;
#X connect 30 0 29 0;
#X connect 30 0 39 0;
#X connect 31 0 6 1;
#X connect 32 0 11 0;
#X connect 35 0 8 0;
#X connect 35 0 16 0;
#X connect 36 0 7 0;
#X connect 36 0 16 1;
#X connect 39 0 40 0;
#X coords 0 0 16 1 0 0 0;
#X restore 47 161 pd FFT-reblocking;
#X obj 47 207 outlet~;
#X obj 47 183 hip~ 5;
#X obj 37 53 inlet;
#N canvas 414 176 1143 484 command-parsing 0;
#X obj 49 60 inlet;
#X obj 492 175 list split 1;
#X obj 495 207 t b a;
#X obj 507 307 s;
#X obj 567 269 symbol;
#X obj 479 243 list;
#X obj 479 264 list trim;
#X obj 492 61 loadbang;
#X obj 567 245 makefilename \$0-timestretch-%s;
#N canvas 45 201 618 639 play-command 0;
#X obj 36 19 inlet;
#X obj 36 417 list append \$0;
#X msg 36 458 \; \$6-timestretch-\$1-rewind bang \; \$6-timestretch-\$1-tablename
\$2 \; \$6-timestretch-\$1-speed \$3 \; \$6-timestretch-\$1-gain \$4
\; \$6-timestretch-\$1-transpo \$5 \;;
#N canvas 522 111 918 767 duration-to-speed 0;
#X obj 147 35 inlet;
#X obj 210 206 symbol;
#X obj 148 298 /;
#X obj 148 407 t b f;
#X obj 166 463 /;
#X obj 166 485 * 100;
#X obj 148 429 f;
#X obj 148 343 t b f;
#X obj 148 374 f;
#X obj 148 320 * 1000;
#X obj 48 169 t a b a;
#X obj 113 477 symbol;
#X obj 125 674 outlet;
#X obj 125 648 pack f s f f f;
#X obj 266 550 t f b;
#X msg 265 594 100;
#X obj 154 541 spigot;
#X obj 266 527 spigot;
#X obj 411 365 swap 1;
#X obj 411 387 -;
#X obj 148 276 array size;
#X obj 272 292 max 0;
#X obj 364 299 == 0;
#X obj 364 274 max 0;
#X obj 522 401 max;
#X obj 48 142 symbol;
#X obj 22 108 t f b f;
#X obj 312 527 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 202 541 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X floatatom 35 388 10 0 0 0 - - -, f 10;
#X floatatom 35 428 10 0 0 0 - - -, f 10;
#X floatatom 35 508 10 0 0 0 - - -, f 10;
#X floatatom 328 620 10 0 0 0 - - -, f 10;
#X floatatom 35 588 10 0 0 0 - - -, f 10;
#X obj 272 268 -;
#X text 358 213 duration-onset ms \, because we're doing a onset ms
normal-speed attack;
#X obj 147 76 unpack f s f f f f f f;
#X text 313 114 player voice ID \, sample table symbol \, samplerate
\, duration \, gain \, transpo \, onset duration \, release %;
#X obj 557 458 *;
#X obj 591 404 / 100;
#X obj 522 423 t f f;
#X obj 522 445 -;
#X obj 450 629 pack f f f f f \$0 f;
#X msg 449 653 \; \$6-timestretch-\$2-samplerate \$7 \; \$6-timestretch-\$2-onset-dur
\$3 \; \$6-timestretch-\$2-speed-post-onset \$1 \; \$6-timestretch-\$2-sustain-time
\$4 \; \$6-timestretch-\$2-release-time \$5 \;;
#X connect 0 0 36 0;
#X connect 1 0 20 1;
#X connect 2 0 9 0;
#X connect 3 0 6 0;
#X connect 3 1 4 1;
#X connect 4 0 5 0;
#X connect 4 0 31 0;
#X connect 5 0 16 0;
#X connect 5 0 17 0;
#X connect 6 0 4 0;
#X connect 7 0 8 0;
#X connect 7 1 6 1;
#X connect 8 0 3 0;
#X connect 8 0 30 0;
#X connect 9 0 7 0;
#X connect 9 0 29 0;
#X connect 10 0 11 0;
#X connect 10 1 20 0;
#X connect 10 2 1 0;
#X connect 11 0 13 1;
#X connect 13 0 12 0;
#X connect 14 0 32 0;
#X connect 14 0 42 0;
#X connect 14 1 15 0;
#X connect 15 0 13 2;
#X connect 16 0 13 2;
#X connect 16 0 33 0;
#X connect 17 0 14 0;
#X connect 18 0 19 0;
#X connect 18 1 19 1;
#X connect 19 0 17 1;
#X connect 19 0 27 0;
#X connect 20 0 2 0;
#X connect 21 0 8 1;
#X connect 22 0 18 0;
#X connect 22 0 16 1;
#X connect 22 0 28 0;
#X connect 23 0 22 0;
#X connect 24 0 40 0;
#X connect 25 0 10 0;
#X connect 26 0 13 0;
#X connect 26 1 25 0;
#X connect 26 2 42 1;
#X connect 34 0 21 0;
#X connect 36 0 26 0;
#X connect 36 1 25 1;
#X connect 36 2 2 1;
#X connect 36 2 42 6;
#X connect 36 3 24 0;
#X connect 36 3 34 0;
#X connect 36 4 13 3;
#X connect 36 5 13 4;
#X connect 36 6 23 0;
#X connect 36 6 24 1;
#X connect 36 6 34 1;
#X connect 36 6 42 2;
#X connect 36 7 39 0;
#X connect 38 0 41 1;
#X connect 38 0 42 4;
#X connect 39 0 38 1;
#X connect 40 0 41 0;
#X connect 40 1 38 0;
#X connect 41 0 42 3;
#X connect 42 0 43 0;
#X restore 36 254 pd duration-to-speed;
#X floatatom 85 327 5 0 0 0 - - -, f 5;
#X text 155 412 tablereader voice ID \, sample table symbol \, speed
\, gain \, transpo \, dollar-zero;
#X text 64 171 No more voiceID counter because we're manually assigning
voice;
#X text 87 66 voiceID \, name of table \, file samplerate \, duration
of note (ms) \, gain (dB) \, transposition (cents) \, onset duration
(ms) \, release time (% of duration);
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 3 0 1 0;
#X connect 3 0 4 0;
#X restore 49 464 pd play-command;
#N canvas 357 239 618 639 attack-command 0;
#X obj 36 19 inlet;
#X obj 36 417 list append \$0;
#N canvas 47 266 818 399 duration-to-speed 0;
#X obj 147 35 inlet;
#X obj 125 314 outlet;
#X obj 48 142 symbol;
#X obj 22 108 t f b f;
#X obj 286 165 pack f f \$0;
#X msg 286 188 \; \$3-timestretch-\$1-onset-dur \$2 \; \$3-timestretch-\$1-speed-post-onset
0 \;;
#X text 374 48 voiceID \, name of table \, gain (dB) \, transposition
(cents) \, onset duration (ms);
#X obj 147 76 unpack f s f f f;
#X obj 125 288 pack f s f f;
#X text 264 287 voice ID \, sample table symbol \, gain \, transpo
;
#X connect 0 0 7 0;
#X connect 2 0 8 1;
#X connect 3 0 8 0;
#X connect 3 1 2 0;
#X connect 3 2 4 0;
#X connect 4 0 5 0;
#X connect 7 0 3 0;
#X connect 7 1 2 1;
#X connect 7 2 8 2;
#X connect 7 3 8 3;
#X connect 7 4 4 1;
#X connect 8 0 1 0;
#X restore 36 254 pd duration-to-speed;
#X floatatom 85 327 5 0 0 0 - - -, f 5;
#X text 87 66 voiceID \, name of table \, file samplerate \, gain (dB)
\, transposition (cents) \, onset duration (ms);
#X text 145 412 tablereader voice ID \, sample table symbol \, gain
\, transpo \, dollar-zero;
#X msg 36 458 \; \$5-timestretch-\$1-transpo \$4 \; \$5-timestretch-\$1-rewind
bang \; \$5-timestretch-\$1-tablename \$2 \; \$5-timestretch-\$1-speed
100 \; \$5-timestretch-\$1-gain \$3 \;;
#X connect 0 0 2 0;
#X connect 1 0 6 0;
#X connect 2 0 1 0;
#X connect 2 0 3 0;
#X restore 129 414 pd attack-command;
#N canvas 822 232 618 639 playhead-command 0;
#X obj 36 19 inlet;
#X obj 36 417 list append \$0;
#X msg 36 458 \; \$3-timestretch-\$1-location \$2 \;;
#N canvas 89 171 773 501 location-percent-to-ms 0;
#X obj 147 35 inlet;
#X obj 199 223 symbol;
#X obj 148 298 /;
#X obj 148 320 * 1000;
#X obj 65 444 outlet;
#X obj 148 276 array size;
#X text 286 27 voiceID \, sample table symbol \, samplerate \, location
(percent);
#X obj 147 76 unpack f s f f;
#X obj 148 342 *;
#X obj 250 332 / 100;
#X obj 65 418 pack f f;
#X obj 76 192 t f b;
#X obj 270 163 clip 0 100;
#X obj 352 359 pack f \$1 \$0;
#X msg 352 400 \; \$3-timestretch-\$2-samplerate \$1 \;;
#X connect 0 0 7 0;
#X connect 1 0 5 1;
#X connect 2 0 3 0;
#X connect 3 0 8 0;
#X connect 5 0 2 0;
#X connect 7 0 11 0;
#X connect 7 1 1 0;
#X connect 7 2 2 1;
#X connect 7 2 13 0;
#X connect 7 3 12 0;
#X connect 8 0 10 1;
#X connect 9 0 8 1;
#X connect 10 0 4 0;
#X connect 11 0 10 0;
#X connect 11 1 5 0;
#X connect 12 0 9 0;
#X connect 13 0 14 0;
#X restore 36 254 pd location-percent-to-ms;
#X text 87 66 voiceID \, sample table symbol \, samplerate \, location
(percent);
#X text 82 284 voice ID \, location (ms);
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 3 0 1 0;
#X restore 199 374 pd playhead-command;
#N canvas 511 172 618 639 release-command 0;
#X obj 36 19 inlet;
#X obj 36 417 list append \$0;
#X text 82 284 voice ID \, release-time (ms);
#X msg 36 458 \; \$3-timestretch-\$1-speed 100 \; \$3-timestretch-\$1-note-off-release-time
\$2 \;;
#N canvas 667 286 773 501 format-release-message 0;
#X obj 147 35 inlet;
#X obj 199 223 symbol;
#X obj 148 298 /;
#X obj 148 320 * 1000;
#X obj 65 444 outlet;
#X obj 148 276 array size;
#X obj 147 76 unpack f s f f;
#X obj 65 418 pack f f;
#X obj 76 192 t f b;
#X text 286 27 voiceID \, name of table \, file samplerate \, release
time (ms);
#X obj 148 364 min;
#X obj 352 359 pack f \$1 \$0;
#X msg 352 400 \; \$3-timestretch-\$2-samplerate \$1 \;;
#X connect 0 0 6 0;
#X connect 1 0 5 1;
#X connect 2 0 3 0;
#X connect 3 0 10 0;
#X connect 5 0 2 0;
#X connect 6 0 8 0;
#X connect 6 1 1 0;
#X connect 6 2 2 1;
#X connect 6 2 11 0;
#X connect 6 3 10 1;
#X connect 7 0 4 0;
#X connect 8 0 7 0;
#X connect 8 1 5 0;
#X connect 10 0 7 1;
#X connect 11 0 12 0;
#X restore 36 254 pd format-release-message;
#X text 87 66 voiceID \, name of table \, file samplerate \, release
time (ms);
#X obj 139 350 unpack f f;
#X floatatom 221 374 5 0 0 0 - - -, f 5;
#X floatatom 139 372 5 0 0 0 - - -, f 5;
#X text 110 178 This should really check to see how much time is left
based on the current playhead position \, and time stretch so that
it plays to the end of the file in exactly the number of (ms) requested
\, fading out as well.;
#X connect 0 0 4 0;
#X connect 1 0 3 0;
#X connect 4 0 1 0;
#X connect 4 0 6 0;
#X connect 6 0 8 0;
#X connect 6 1 7 0;
#X restore 269 334 pd release-command;
#X msg 492 91 window-size 1024 \, samplerate 44100;
#X msg 834 204 16;
#X obj 834 226 until;
#X obj 834 278 f;
#X obj 864 280 + 1;
#X msg 852 254 0;
#X obj 834 182 t b f b;
#X obj 834 320 pack f f \$0;
#X msg 834 342 \; \$3-timestretch-\$1-samplerate \$2 \;;
#X obj 834 160 r \$0-timestretch-samplerate;
#X text 515 134 These are global params;
#N canvas 435 120 556 421 bend-command 0;
#X obj 111 36 inlet;
#X obj 111 70 list append \$0;
#X msg 111 92 \; \$3-timestretch-\$1-bend \$2 \;;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X restore 331 282 pd bend-command;
#X obj 49 82 route play attack playhead release bend amp;
#N canvas 927 495 556 421 amp-command 0;
#X obj 111 36 inlet;
#X obj 111 70 list append \$0;
#X msg 111 92 \; \$3-timestretch-\$1-gain \$2 \;;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X restore 337 202 pd amp-command;
#X connect 0 0 25 0;
#X connect 1 0 2 0;
#X connect 1 1 5 1;
#X connect 2 0 5 0;
#X connect 2 1 8 0;
#X connect 4 0 3 1;
#X connect 5 0 6 0;
#X connect 6 0 3 0;
#X connect 7 0 13 0;
#X connect 8 0 4 0;
#X connect 13 0 1 0;
#X connect 14 0 15 0;
#X connect 15 0 16 0;
#X connect 16 0 17 0;
#X connect 16 0 20 0;
#X connect 17 0 16 1;
#X connect 18 0 16 1;
#X connect 19 0 14 0;
#X connect 19 1 20 1;
#X connect 19 2 18 0;
#X connect 20 0 21 0;
#X connect 22 0 19 0;
#X connect 25 0 9 0;
#X connect 25 1 10 0;
#X connect 25 2 11 0;
#X connect 25 3 12 0;
#X connect 25 4 24 0;
#X connect 25 5 26 0;
#X connect 25 6 1 0;
#X restore 37 78 pd command-parsing;
#X text 62 242 Need to make the incoming "transpo" message something
else \, like "bend". Then this can be added to the actual transpo value
that comes in with a play or attack comamnd.;
#X text 188 73 << need to look over attack/release/play commands for
redundant info. For instance \, a given voice should know its sample's
sampling rate and array name symbol. No need to pass those in again.
;
#X obj 414 176 declare -path ./lib;
#X connect 0 0 2 0;
#X connect 2 0 1 0;
#X connect 3 0 4 0;
