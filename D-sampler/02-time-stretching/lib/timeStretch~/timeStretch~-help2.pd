#N canvas 193 35 871 557 10;
#X text 487 143 Polyphony is hard-coded to 16 voices;
#N canvas 604 113 687 375 preset-duration-playback 0;
#X obj 54 299 outlet;
#X msg 54 67 play 0 this-sample 44100 30000 94 0 250 30;
#X msg 87 97 play 1 this-sample 44100 30000 94 100 0 40;
#X msg 136 130 play 2 that-sample 44100 10000 86 -300 500 10;
#X msg 163 159 play 3 that-sample 44100 7000 86 600 500 10;
#X text 199 235 voiceID \, name of table \, file samplerate \, duration
of note (ms) \, gain (dB) \, transposition (cents) \, onset duration
(ms) \, release time (% of duration);
#X connect 1 0 0 0;
#X connect 2 0 0 0;
#X connect 3 0 0 0;
#X connect 4 0 0 0;
#X restore 58 46 pd preset-duration-playback;
#N canvas 641 134 947 692 attack-release-playback 0;
#X text 405 316 voiceID \, name of table \, file samplerate \, release
time (ms);
#X msg 117 237 playhead 0 this-sample 44100 \$1;
#X text 365 230 voiceID \, name of table \, file samplerate \, playhead
position (percent);
#X obj 54 635 outlet;
#X floatatom 117 206 5 0 0 0 - - -, f 5;
#X floatatom 227 536 5 0 0 0 - - -, f 5;
#X msg 227 567 playhead 1 that-sample 44100 \$1;
#X msg 237 597 release 1 that-sample 44100 2000;
#N canvas 681 51 594 326 ms-to-percent 0;
#X obj 139 86 array size this-sample;
#X obj 61 8 inlet;
#X obj 61 30 t f b;
#X obj 139 118 / 44.1;
#X obj 61 152 /;
#X obj 61 204 * 100;
#X obj 61 276 outlet;
#X floatatom 91 246 5 0 0 0 - - -, f 5;
#X text 195 117 convert to ms (assuming 44100 sampling rate);
#X text 124 204 convert to percent;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 4 0;
#X connect 2 1 0 0;
#X connect 3 0 4 1;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 5 0 7 0;
#X restore 117 122 pd ms-to-percent;
#X floatatom 233 74 5 0 0 0 - - -, f 5;
#X msg 117 144 set \$1;
#X obj 54 44 t a a;
#X obj 86 74 unpack s f s f f f;
#X text 252 109 convert the onset duration to percent so that you can
set the starting position of the playhead command below if you'd like
to move forward or back after the onset occurs.;
#N canvas 681 51 594 326 ms-to-percent 0;
#X obj 61 8 inlet;
#X obj 61 30 t f b;
#X obj 139 118 / 44.1;
#X obj 61 152 /;
#X obj 61 204 * 100;
#X obj 61 276 outlet;
#X floatatom 91 246 5 0 0 0 - - -, f 5;
#X text 195 117 convert to ms (assuming 44100 sampling rate);
#X text 124 204 convert to percent;
#X obj 139 86 array size that-sample;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 1 1 9 0;
#X connect 2 0 3 1;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 4 0 6 0;
#X connect 9 0 2 0;
#X restore 393 479 pd ms-to-percent;
#X msg 393 501 set \$1;
#X obj 204 452 t a a;
#X obj 236 482 unpack s f s f f f;
#X floatatom 137 264 5 0 0 0 - - -, f 5;
#X text 245 275 transpose pitch (cents);
#X msg 204 412 attack 1 that-sample 94 0 250;
#X msg 137 284 bend 0 \$1;
#X msg 157 317 release 0 this-sample 44100 2000;
#X msg 54 22 attack 0 this-sample 94 0 500;
#X connect 1 0 3 0;
#X connect 4 0 1 0;
#X connect 5 0 6 0;
#X connect 6 0 3 0;
#X connect 7 0 3 0;
#X connect 8 0 10 0;
#X connect 10 0 4 0;
#X connect 11 0 3 0;
#X connect 11 1 12 0;
#X connect 12 5 9 0;
#X connect 12 5 8 0;
#X connect 14 0 15 0;
#X connect 15 0 5 0;
#X connect 16 0 3 0;
#X connect 16 1 17 0;
#X connect 17 5 14 0;
#X connect 18 0 21 0;
#X connect 20 0 16 0;
#X connect 21 0 3 0;
#X connect 22 0 3 0;
#X connect 23 0 11 0;
#X restore 98 87 pd attack-release-playback;
#N canvas 4 23 508 365 settings 0;
#X msg 135 138 window-size \$1;
#X msg 135 43 512;
#X msg 155 63 1024;
#X msg 175 83 2048;
#X msg 195 103 4096;
#X obj 135 270 outlet;
#X msg 202 214 samplerate 44100;
#X obj 202 187 loadbang;
#X connect 0 0 5 0;
#X connect 1 0 0 0;
#X connect 2 0 0 0;
#X connect 3 0 0 0;
#X connect 4 0 0 0;
#X connect 6 0 5 0;
#X connect 7 0 6 0;
#X restore 237 191 pd settings;
#N canvas 416 296 835 385 load-samples 1;
#X obj 295 185 soundfiler;
#X obj 295 54 loadbang;
#X obj 55 104 table this-sample;
#X obj 55 134 table that-sample;
#X msg 328 127 read -resize ./oboe-1.wav that-sample;
#X msg 295 101 read -resize ./piano-72.wav this-sample;
#X floatatom 383 233 10 0 0 0 - - -, f 10;
#X obj 367 296 outlet;
#X msg 367 264 samplerate \$1;
#X text 495 257 Send this to [timeStretch~] to update the samplerate
setting if needed, f 32;
#X msg 478 52 read -resize \$1 this-sample;
#X obj 478 7 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 478 27 openpanel;
#X connect 0 1 6 0;
#X connect 0 1 8 0;
#X connect 1 0 5 0;
#X connect 1 0 4 0;
#X connect 4 0 0 0;
#X connect 5 0 0 0;
#X connect 8 0 7 0;
#X connect 10 0 0 0;
#X connect 11 0 12 0;
#X connect 12 0 10 0;
#X restore 561 102 pd load-samples;
#N canvas 4 23 592 473 output 0;
#X obj 370 277 *~;
#X obj 362 306 dac~;
#X floatatom 110 128 5 0 0 1 dB - -, f 5;
#X obj 380 195 dbtorms;
#X obj 273 305 env~;
#X obj 380 217 pack f 40;
#X obj 380 239 line~;
#X obj 306 126 inlet~;
#X obj 273 327 - 100;
#X obj 111 170 vu 15 120 empty empty -1 -8 0 10 -66577 -1 1 0;
#X obj 293 33 loadbang;
#X msg 293 55 100;
#X connect 0 0 1 0;
#X connect 0 0 1 1;
#X connect 2 0 3 0;
#X connect 3 0 5 0;
#X connect 4 0 8 0;
#X connect 5 0 6 0;
#X connect 6 0 0 1;
#X connect 7 0 4 0;
#X connect 7 0 0 0;
#X connect 8 0 9 0;
#X connect 10 0 11 0;
#X connect 11 0 2 0;
#X coords 0 -1 1 1 100 200 1 100 100;
#X restore 58 312 pd output;
#N canvas 196 23 1017 623 trigger-attack-with-vibrato-polyphonic 1
;
#X obj 59 725 outlet;
#N canvas 681 51 594 326 ms-to-percent 0;
#X obj 139 86 array size this-sample;
#X obj 61 8 inlet;
#X obj 61 30 t f b;
#X obj 139 118 / 44.1;
#X obj 61 152 /;
#X obj 61 204 * 100;
#X obj 61 276 outlet;
#X floatatom 91 246 5 0 0 0 - - -, f 5;
#X text 195 117 convert to ms (assuming 44100 sampling rate);
#X text 124 204 convert to percent;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 4 0;
#X connect 2 1 0 0;
#X connect 3 0 4 1;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 5 0 7 0;
#X restore 119 521 pd ms-to-percent;
#X floatatom 228 484 5 0 0 0 - - -, f 5;
#X obj 59 434 t a a;
#X obj 91 484 unpack s f s f f f;
#X msg 119 617 playhead \$2 this-sample 44100 \$1;
#X floatatom 119 566 5 0 0 0 - - -, f 5;
#X obj 119 585 pack f f;
#X msg 119 543 set \$1;
#X obj 604 456 route release;
#X obj 604 478 list split 1;
#X msg 574 590 bend \$1 0;
#X obj 604 500 pipe;
#X obj 654 500 unpack s f f;
#X text 777 496 turn off vibrato after release, f 17;
#N canvas 149 23 712 623 poly-vibrato 0;
#X obj 430 571 metro 10;
#X obj 78 104 osc~ 6;
#X floatatom 524 209 5 0 0 1 vib-depth-cents - -, f 5;
#X floatatom 524 139 5 0 0 1 vib-onset-ms - -, f 5;
#X obj 430 548 loadbang;
#X obj 247 638 outlet;
#X text 67 21 keep all voices' vibrato phase locked with a single LFO
, f 22;
#X obj 361 59 list prepend;
#X obj 361 29 inlet;
#X obj 451 29 inlet;
#X obj 430 593 s tsVibPolyTick;
#X obj 524 228 s tsVibPolyDepth;
#X obj 524 158 s tsVibPolyVibOnset;
#X msg 361 81 \; tsVibPolyOnsetTime-\$1 \$2 \;;
#X obj 247 130 tsVibPoly 0;
#X obj 78 126 s~ tsVibPolyLFO;
#X obj 277 190 tsVibPoly 3;
#X obj 267 170 tsVibPoly 2;
#X obj 257 150 tsVibPoly 1;
#X obj 287 210 tsVibPoly 4;
#X obj 297 230 tsVibPoly 5;
#X obj 307 250 tsVibPoly 6;
#X obj 317 270 tsVibPoly 7;
#X obj 327 290 tsVibPoly 8;
#X obj 337 310 tsVibPoly 9;
#X obj 347 330 tsVibPoly 10;
#X obj 357 350 tsVibPoly 11;
#X obj 367 370 tsVibPoly 12;
#X obj 377 390 tsVibPoly 13;
#X obj 387 410 tsVibPoly 14;
#X obj 397 430 tsVibPoly 15;
#X connect 0 0 10 0;
#X connect 1 0 15 0;
#X connect 2 0 11 0;
#X connect 3 0 12 0;
#X connect 4 0 0 0;
#X connect 7 0 13 0;
#X connect 8 0 7 0;
#X connect 9 0 7 1;
#X connect 14 0 5 0;
#X connect 16 0 5 0;
#X connect 17 0 5 0;
#X connect 18 0 5 0;
#X connect 19 0 5 0;
#X connect 20 0 5 0;
#X connect 21 0 5 0;
#X connect 22 0 5 0;
#X connect 23 0 5 0;
#X connect 24 0 5 0;
#X connect 25 0 5 0;
#X connect 26 0 5 0;
#X connect 27 0 5 0;
#X connect 28 0 5 0;
#X connect 29 0 5 0;
#X connect 30 0 5 0;
#X restore 435 665 pd poly-vibrato;
#N canvas 1154 23 744 397 pseudocode 0;
#X text 87 43 assign voiceID with [poly];
#X text 87 103 send attack command;
#X text 87 123 parse onset time from attack command and use to schedule
vibrato ramp;
#X text 87 63 set bend to 0 for this voice;
#X text 67 23 MIDI note on;
#X text 67 193 MIDI note off;
#X text 87 213 parse release time from command;
#X text 87 263 send bend 0 message;
#X text 87 83 turn voice flag on for this voice;
#X text 87 233 turn voice flag off for this voice after release time
ms passes;
#X restore 709 44 pd pseudocode;
#N canvas 0 23 450 300 flags-off 0;
#X obj 121 81 t b f;
#X obj 121 133 tabwrite voice-flags;
#X msg 121 103 0;
#X obj 54 26 inlet;
#X obj 54 48 t f f;
#X obj 54 200 outlet;
#X connect 0 0 2 0;
#X connect 0 1 1 1;
#X connect 2 0 1 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 4 1 0 0;
#X restore 604 531 pd flags-off;
#X msg 604 418 release \$1 this-sample 44100 2000;
#X obj 405 438 t f f;
#X obj 17 293 t f f;
#X obj 59 375 pack f f f;
#X obj 157 329 / 127;
#X obj 157 351 * 24;
#X text 199 352 24dB of gain headroom;
#X obj 157 373 + 76;
#X obj 17 264 spigot;
#X obj 157 253 t f f;
#X obj 207 280 > 0;
#X obj 157 305 spigot;
#X obj 603 387 spigot;
#X obj 653 362 == 0;
#X obj 77 323 * 100;
#X obj 17 229 - 1;
#X text 66 228 voiceIDs should start at 0 in this patch \, but [poly]
starts at 1;
#X obj 75 190 poly 16;
#X text 712 321 manually un-check to release a given voice, f 22;
#X obj 630 230 t b f;
#X msg 630 252 1;
#X obj 630 274 tabwrite voice-flags;
#X obj 723 212 table voice-flags 16;
#X obj 100 77 notein;
#X floatatom 28 181 5 0 0 0 - - -, f 5;
#X obj 65 132 - 72;
#X msg 59 402 attack \$1 this-sample \$3 \$2 200;
#X connect 1 0 8 0;
#X connect 3 0 0 0;
#X connect 3 1 4 0;
#X connect 4 5 2 0;
#X connect 4 5 1 0;
#X connect 4 5 15 0;
#X connect 5 0 0 0;
#X connect 6 0 7 0;
#X connect 7 0 5 0;
#X connect 8 0 6 0;
#X connect 9 0 10 0;
#X connect 10 0 12 0;
#X connect 10 1 13 0;
#X connect 11 0 0 0;
#X connect 12 0 17 0;
#X connect 13 2 12 1;
#X connect 15 0 0 0;
#X connect 17 0 11 0;
#X connect 18 0 0 0;
#X connect 18 0 9 0;
#X connect 19 0 15 1;
#X connect 19 0 7 1;
#X connect 19 0 37 0;
#X connect 19 1 11 0;
#X connect 20 0 21 0;
#X connect 20 1 19 0;
#X connect 21 0 44 0;
#X connect 22 0 23 0;
#X connect 23 0 25 0;
#X connect 25 0 21 2;
#X connect 26 0 20 0;
#X connect 27 0 29 0;
#X connect 27 1 28 0;
#X connect 27 1 31 0;
#X connect 28 0 29 1;
#X connect 28 0 26 1;
#X connect 29 0 22 0;
#X connect 30 0 18 0;
#X connect 31 0 30 1;
#X connect 32 0 21 1;
#X connect 33 0 26 0;
#X connect 33 0 30 0;
#X connect 35 0 33 0;
#X connect 35 1 32 0;
#X connect 35 2 27 0;
#X connect 37 0 38 0;
#X connect 37 1 39 1;
#X connect 38 0 39 0;
#X connect 41 0 43 0;
#X connect 41 1 35 1;
#X connect 43 0 35 0;
#X connect 43 0 42 0;
#X connect 44 0 3 0;
#X restore 141 146 pd trigger-attack-with-vibrato-polyphonic;
#X obj 58 275 timeStretch~;
#X connect 1 0 7 0;
#X connect 2 0 7 0;
#X connect 3 0 7 0;
#X connect 6 0 7 0;
#X connect 7 0 5 0;
